import java.util.Properties

def envProperties = new Properties()
file('env.properties').withInputStream { inputStream ->
    envProperties.load(inputStream)
}

def javaVersion = envProperties.getProperty('java.version', '20')
def vmArgs
vmArgs = envProperties.getProperty('vm.args', '-Xmx2g')

tasks.register('env') {

    doFirst {
        toolchain {
            languageVersion = JavaLanguageVersion.of(javaVersion)
        }
    }


    def command = "deploy C:/Users/Honor/opi_lab3-1.0-SNAPSHOT.war"
    exec {
        commandLine 'java', '-jar', "build/libs/${project.name}-${version}.jar", vmArgs.tokenize()
        commandLine ('jar', '-cvf', "build/libs/${project.name}-${version}.war", "src/main/webapp/WEB-INF")
        commandLine('cd', 'C:\\Users\\Honor\\Downloads\\wildfly-30.0.0.Final\\wildfly-30.0.0.Final\\bin')
        commandLine("./jboss-cli.sh --connect --command=" + command)
    }
}










